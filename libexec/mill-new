#!/bin/sh

# MILL NEW #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# Usage: mill new <NAME> [stationery]
# Summary: Make a blank paper from the stationery.
# Help: Create a new folder with the name you choose
# and some content to get you started.
# Optionally choose a stationery (default is Paper).
#
# Stationaries:
# * Paper
# * Simple
#

set -e
source $_MILL_ROOT/share/mill/local.config

NAME="$1"

# DEFAULT STATIONERY
STATIONERY="Paper"

echo "[>] Creating new "$STATIONERY" in /"$NAME""

# TODO: clone to tmp dir, just move stuff from sub-dir

git clone -q --depth=1 "$STATIONERY_REPO" "$NAME" \
&& cd "$NAME/$STATIONERY" \
&& mv "Document.markdown" ""$NAME".markdown" \
&& cd .. \
&& mv "$STATIONERY"/* . \
&& rm -rf ".git" "README.md" "Simple" "Paper" \
&& git init -q \
&& git add --all \
&& git commit -m "Starting $NAME" |while read REPLY; do echo "    [#] $REPLY"; done \
&& echo "    [#] SUCCESS!" \
&& echo "[<] Started new "$STATIONERY" in /"$NAME"" \
&& echo "[!] If you don't want git, just delete the .git folder." \
&& mill shim open "." \
mill shim open ""$NAME".markdown"
